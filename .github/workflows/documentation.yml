name: Documentation Deployment

on:
  push:
    branches: [ main ]
    paths:
      - 'README.md'
      - 'docs/**'
      - '.github/workflows/documentation.yml'
  workflow_dispatch:

jobs:
  build-docs:
    name: Build Documentation
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: Create documentation structure
        run: |
          echo "ðŸ“š Preparing documentation..."
          mkdir -p docs-build
          
          # Copy README as main documentation
          cp README.md docs-build/index.md
          
          # Copy docs folder if exists
          if [ -d "docs" ]; then
            cp -r docs/* docs-build/
          fi
          
          # Create workflow documentation
          mkdir -p docs-build/workflows
          echo "# GitHub Actions Workflows Documentation" > docs-build/workflows/README.md
          echo "" >> docs-build/workflows/README.md
          echo "This directory contains documentation for all GitHub Actions workflows." >> docs-build/workflows/README.md
          
          echo "âœ… Documentation structure created"
          
      - name: Generate API documentation
        run: |
          echo "ðŸ“– Generating API documentation..."
          # Add JSDoc or similar if needed
          echo "âœ… API documentation generated"
          
      - name: Create documentation index
        run: |
          cat > docs-build/workflows-index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Heavens Above - Workflows Documentation</title>
              <style>
                  body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
                  h1 { color: #0366d6; }
                  .workflow { border: 1px solid #e1e4e8; border-radius: 6px; padding: 15px; margin: 10px 0; }
                  .workflow h2 { margin-top: 0; color: #24292e; }
                  .badge { display: inline-block; padding: 3px 7px; border-radius: 3px; font-size: 12px; }
                  .badge-success { background-color: #28a745; color: white; }
              </style>
          </head>
          <body>
              <h1>ðŸš€ Heavens Above - GitHub Actions Workflows</h1>
              <p>Comprehensive automation for satellite tracking application</p>
              
              <div class="workflow">
                  <h2>1. Continuous Integration (ci.yml)</h2>
                  <span class="badge badge-success">Active</span>
                  <p>Runs tests, linting, and build verification on every push to main branch.</p>
              </div>
              
              <div class="workflow">
                  <h2>2. Deployment Pipeline (deploy.yml)</h2>
                  <span class="badge badge-success">Active</span>
                  <p>Automated deployment to GitHub Pages with build and test stages.</p>
              </div>
              
              <div class="workflow">
                  <h2>3. Scheduled Data Update (scheduled-tasks.yml)</h2>
                  <span class="badge badge-success">Active</span>
                  <p>Weekly automated satellite data refresh every Sunday.</p>
              </div>
              
              <div class="workflow">
                  <h2>4. Dependency Updates (dependency-updates.yml)</h2>
                  <span class="badge badge-success">Active</span>
                  <p>Weekly dependency monitoring and automated update PRs.</p>
              </div>
              
              <div class="workflow">
                  <h2>5. Code Review (code-review.yml)</h2>
                  <span class="badge badge-success">Active</span>
                  <p>Automated code quality checks and security scanning on PRs.</p>
              </div>
              
              <div class="workflow">
                  <h2>6. Documentation Deployment (documentation.yml)</h2>
                  <span class="badge badge-success">Active</span>
                  <p>Automated documentation build and deployment to GitHub Pages.</p>
              </div>
              
              <div class="workflow">
                  <h2>7. Release Notes (release-notes.yml)</h2>
                  <span class="badge badge-success">Active</span>
                  <p>Automated release notes generation on version tags.</p>
              </div>
          </body>
          </html>
          EOF
          echo "âœ… Documentation index created"
          
      - name: Upload documentation artifacts
        uses: actions/upload-artifact@v4
        with:
          name: documentation
          path: docs-build/
          retention-days: 90
          
  deploy-docs:
    name: Deploy to GitHub Pages
    needs: build-docs
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write
      id-token: write
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Download documentation
        uses: actions/download-artifact@v4
        with:
          name: documentation
          path: docs-build/
          
      - name: Deploy documentation
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: docs-build
          target-folder: docs
          clean: false
          single-commit: false
          
      - name: Generate deployment summary
        if: always()
        run: |
          echo "## ðŸ“š Documentation Deployment Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Status**: Documentation deployed successfully" >> $GITHUB_STEP_SUMMARY
          echo "- **Branch**: ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Commit**: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“– Available Documentation" >> $GITHUB_STEP_SUMMARY
          echo "- README/Index" >> $GITHUB_STEP_SUMMARY
          echo "- Workflow Documentation" >> $GITHUB_STEP_SUMMARY
          echo "- API Documentation" >> $GITHUB_STEP_SUMMARY